<app-header></app-header>

<div class="main-content mt-4">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <form [formGroup]="countryListForm" class="row g-3">
          <div class="col-md-5">
            <div class="input-group">
              <span
                class="material-icons-outlined input-group-text"
                [ngClass]="darkModeStatus == true ? 'dark-icon' : 'light-icon'"
              >
                search
              </span>
              <input
                type="text"
                class="form-control"
                placeholder="Search for a country..."
                formControlName="country"
                (input)="search($event.target.value)"
                [ngClass]="
                  darkModeStatus == true ? 'dark-input' : 'light-input'
                "
              />
              <span
                class="input-group-text clear_btn material-icons-outlined"
                (click)="countryListForm.get('country').reset()"
                [ngClass]="
                  darkModeStatus == true ? 'dark-icon' : 'light-clear-btn'
                "
              >
                clear_all
              </span>
            </div>
          </div>

          <div class="col-md-3">
            <select
              class="form-select"
              formControlName="filterOptions"
              (change)="searchFilter($event)"
              [ngClass]="
                darkModeStatus == true ? 'dark-select' : 'light-select'
              "
            >
              <option [value]="items" *ngFor="let items of searchFilterOptions">
                Search by {{ items }}
              </option>
            </select>
          </div>
          <div class="col-md-3">
            <select
              class="form-select"
              formControlName="region"
              (change)="regionsList($event)"
              [ngClass]="
                darkModeStatus == true ? 'dark-select' : 'light-select'
              "
            >
              <option value="" selected disabled>Filter by Region</option>
              <option value="{{ region }}" *ngFor="let region of newRegArr">
                {{ region }}
              </option>
            </select>
          </div>
        </form>
      </div>
    </div>

    <!-- Displaying cards  -->
    <div class="card-content mt-3">
      <div class="row">
        <div
          class="col-md-3 mb-3"
          *ngFor="
            let data of listOfCountries
              | filter: searchedData
              | paginate: { itemsPerPage: 4, currentPage: page };
            let i = index
          "
        >
          <div
            class="card country-card"
            [ngClass]="darkModeStatus == true ? 'dark-card' : 'light-card'"
          >
            <img
              [src]="data.flag"
              alt="{{ data.name }}"
              class="country-flag card-img-top"
            />
            <div
              class="card-body"
              [ngClass]="darkModeStatus == true ? 'dark-title' : 'light-title'"
            >
              <h5 class="card-title">{{ data.name }}</h5>
            </div>
            <ul class="list-group">
              <li
                class="list-group-item"
                *ngIf="data?.population !== ''"
                [ngClass]="darkModeStatus == true ? 'dark-list' : 'light-list'"
              >
                Population : {{ data.population | comaSeperator }}
              </li>
              <li
                class="list-group-item"
                *ngIf="data?.region !== ''"
                [ngClass]="darkModeStatus == true ? 'dark-list' : 'light-list'"
              >
                Region :
                {{ data.region }}
              </li>
              <li
                class="list-group-item"
                *ngIf="data?.capital !== ''"
                [ngClass]="darkModeStatus == true ? 'dark-list' : 'light-list'"
              >
                Capital :
                {{ data.capital }}
              </li>
            </ul>
            <div class="card-footer">
              <a
                [routerLink]="['/country']"
                [queryParams]="{ name: data.name }"
                class="card-link"
              >
                More
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- pagination  -->
    <div class="row">
      <div class="col-md-12">
        <pagination-controls
          class="float-end"
          [ngClass]="darkModeStatus == true ? 'dark-page' : 'light-page'"
          (pageChange)="page = $event"
          maxSize="4"
          directionLinks="true"
          autoHide="true"
          responsive="true"
          previousLabel="Previous Page"
          nextLabel="Next Page"
          screenReaderPaginationLabel="Pagination"
          screenReaderPageLabel="{{ page }}"
          screenReaderCurrentLabel="You're on {{ page }}"
        ></pagination-controls>
      </div>
    </div>
  </div>
</div>

<router-outlet></router-outlet>

<!-- spinner while loading screen  -->
<ngx-spinner
  bdColor="rgba(51, 51, 51, 0.8)"
  size="default"
  type="ball-spin-clockwise"
>
  <h4 mat-subheading-1 class="fs-5">
    {{
      regionSelected === true
        ? "Getting " + regionValue + " Countries"
        : "Please Wait."
    }}
  </h4>
  <p class="text-center fs-6" mat-body-1 *ngIf="regionSelected === true">
    Please Wait.
  </p>
</ngx-spinner>
